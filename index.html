<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FPC - Sistema v20 (Admin Pro)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --fpc-navy: #132047; --pe-blue: #0038a8; --pe-yellow: #ffcc29; --pe-red: #d50000; --pe-green: #009b3a;
            --bg-grad: linear-gradient(to bottom, #f0f4f8 0%, #ffffff 100%);
            --glass-bg: rgba(255, 255, 255, 0.98); --text-main: #132047;
            --gold-grad: linear-gradient(135deg, #d4af37 0%, #f1c40f 100%);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        /* MAI√öSCULAS VISUAIS */
        input, select, textarea, button, .menu-card b, h1, h2, .event-city, .cat-auto { text-transform: uppercase; }
        
        body { background: var(--bg-grad); height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .app-container { width: 100%; height: 100%; max-width: 420px; background: var(--glass-bg); position: relative; overflow-y: auto; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* GERAL */
        h1 { font-size: 22px; font-weight: 800; color: var(--fpc-navy); text-align: center; margin-bottom: 5px; }
        p.subtitle { text-align: center; color: #64748b; font-size: 12px; margin-bottom: 20px; text-transform: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; background: linear-gradient(135deg, var(--fpc-navy), var(--pe-blue)); color: white; font-weight: 700; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .btn:active { transform: scale(0.98); }
        
        /* INPUTS */
        .input-group { margin-bottom: 12px; position: relative; }
        .input-group label { font-size: 10px; font-weight: 800; color: var(--fpc-navy); margin-left: 10px; display: block; margin-bottom: 3px; }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input, select, textarea { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; background: #f8fafc; font-size: 14px; color: var(--text-main); font-weight: 600; }
        input:focus, textarea:focus { border-color: var(--pe-blue); background: white; }
        
        .icon-eye, .icon-search { position: absolute; right: 5px; color: #a0aec0; cursor: pointer; z-index: 10; font-size: 16px; padding: 10px; }
        
        /* Search Dropdown (Admin) */
        .search-dropdown { position: absolute; top: 100%; left: 0; width: 100%; background: white; border: 1px solid #ddd; border-radius: 0 0 10px 10px; z-index: 100; max-height: 150px; overflow-y: auto; display: none; box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .search-item { padding: 10px; border-bottom: 1px solid #eee; font-size: 11px; cursor: pointer; display: flex; justify-content: space-between; }
        .search-item:hover { background: #f0f9ff; }

        /* TELAS */
        .screen { display: none; padding: 20px; min-height: 100%; flex-direction: column; animation: fade 0.3s; }
        .screen.active { display: flex; }
        .screen-center { justify-content: center; }
        @keyframes fade { from { opacity:0; } to { opacity:1; } }

        /* HEADER & MENU */
        .app-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid #eee; margin-top: 25px; margin-bottom: 15px; }
        .header-logo { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--pe-blue); overflow: hidden; background: #eee; }
        .header-logo img { width: 100%; height: 100%; object-fit: cover; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .menu-card { background: white; padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border-bottom: 3px solid transparent; }
        .menu-card i { font-size: 24px; margin-bottom: 5px; }
        .menu-card b { font-size: 11px; display: block; color: var(--fpc-navy); }
        
        .c-dh { border-color: var(--pe-red); } .c-dh i { color: var(--pe-red); }
        .c-sp { border-color: var(--pe-blue); } .c-sp i { color: var(--pe-blue); }
        .c-mtb { border-color: var(--pe-green); } .c-mtb i { color: var(--pe-green); }
        .c-xc { border-color: var(--pe-yellow); } .c-xc i { color: #f59e0b; }
        .c-sorte { border-color: #8b5cf6; background: #f5f3ff; } .c-sorte i { color: #8b5cf6; }

        .cat-tabs { display: flex; background: #f1f5f9; border-radius: 10px; padding: 4px; margin-bottom: 15px; }
        .tab-item { flex: 1; text-align: center; padding: 8px; font-size: 10px; font-weight: bold; color: #64748b; border-radius: 8px; cursor: pointer; }
        .tab-item.active { background: white; color: var(--fpc-navy); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* LISTAS USER */
        .event-card { background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .event-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px; }
        .event-date { font-size: 10px; font-weight: 900; color: var(--pe-blue); background: #ebf8ff; padding: 3px 6px; border-radius: 4px; }
        .event-city { font-size: 10px; color: #666; font-weight: bold; display: flex; align-items: center; gap: 4px; margin-top: 2px; }
        
        /* BADGES */
        .badge-box { display: flex; gap: 3px; }
        .badge { font-size: 8px; color: #fff; padding: 2px 5px; border-radius: 4px; font-weight: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-shadow: 0 1px 1px rgba(0,0,0,0.2); }
        .b-cbc { background: linear-gradient(45deg, #ffd700, #ffaa00); }
        .b-est { background: linear-gradient(45deg, #0038a8, #0050f0); }

        .btn-insc { background: var(--pe-green); color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; }
        .btn-insc.pendente { background: var(--pe-yellow); color: #555; cursor: default; }
        .btn-insc.inscrito { background: var(--fpc-navy); cursor: default; }

        /* RANKING & INSCRITOS */
        .rank-header { display: flex; font-size: 9px; font-weight: bold; color: #999; padding: 0 10px 5px 10px; border-bottom: 2px solid #eee; margin-bottom: 5px; }
        .rank-row { display: flex; align-items: center; padding: 12px 10px; border-bottom: 1px solid #f5f5f5; font-size: 12px; background: white; border-radius: 8px; margin-bottom: 5px; }
        .rank-pos { width: 30px; font-weight: 900; color: white; background: var(--pe-blue); font-size: 12px; height: 25px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 10px; }
        .rank-name { flex: 1; font-weight: 600; color: var(--fpc-navy); display: flex; flex-direction: column; }
        .rank-cat { font-size: 9px; color: #888; font-weight: normal; }
        .rank-val { font-family: 'Courier New', monospace; font-weight: 900; color: var(--fpc-navy); background: #e0e7ff; padding: 4px 8px; border-radius: 6px; }

        /* PLANOS DE SEGURO */
        .plan-container { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .plan-card { min-width: 200px; background: white; border-radius: 10px; border: 1px solid #eee; padding: 15px; position: relative; }
        .plan-card.highlight { border: 2px solid var(--pe-green); box-shadow: 0 5px 15px rgba(0,155,58,0.1); }
        .plan-title { font-size: 14px; font-weight: 800; color: var(--fpc-navy); margin-bottom: 5px; }
        .plan-price { font-size: 18px; font-weight: 900; color: var(--pe-green); margin-bottom: 10px; }
        .plan-list { list-style: none; font-size: 10px; color: #555; text-align: left; }
        .plan-list li { margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        .plan-list li i { color: var(--pe-blue); }

        /* ABA DA SORTE */
        .federal-board { background: #0044a0; color: white; padding: 10px; border-radius: 10px; margin-bottom: 15px; border: 2px solid #eab308; box-shadow: 0 4px 10px rgba(0,0,0,0.2); position: relative; }
        .federal-header { text-align: center; font-size: 10px; font-weight: bold; color: #eab308; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px; }
        .federal-row { display: flex; justify-content: space-between; align-items: center; background: white; color: #0044a0; margin-bottom: 4px; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 900; font-family: 'Courier New', monospace; }
        .federal-row span { font-size: 10px; font-family: 'Poppins'; color: #666; font-weight: bold; width: 30px; }
        .update-badge { position: absolute; top: -8px; right: -8px; background: #22c55e; color: white; font-size: 9px; padding: 2px 6px; border-radius: 10px; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .luck-tabs { display: flex; gap: 5px; margin-bottom: 15px; }
        .luck-tab { flex: 1; background: #eee; padding: 10px; font-size: 10px; font-weight: 800; text-align: center; border-radius: 8px; cursor: pointer; color: #666; transition:0.3s; }
        .luck-tab.active { background: #8b5cf6; color: white; box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3); transform: scale(1.05); }

        .luck-inputs-container { display: flex; gap: 10px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #eee; }
        .luck-field { flex: 1; }
        .luck-field label { font-size: 9px; font-weight: 800; color: #999; display: block; margin-bottom: 2px; }
        .luck-field input { width: 100%; text-align: center; font-size: 16px; font-weight: 900; border: 2px solid #ddd; padding: 8px; border-radius: 8px; color: #132047; }
        .luck-field input:focus { border-color: #8b5cf6; }

        .cart-list { max-height: 150px; overflow-y: auto; text-align: left; margin-top: 10px; }
        .cart-item { background: #f5f3ff; border: 1px solid #ddd6fe; border-radius: 8px; padding: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 11px; }

        /* TICKET ELEGANTE */
        .ticket-modal { background: white; width: 100%; border-radius: 20px; overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.3); position: relative; }
        .ticket-top { background: var(--fpc-navy); color: white; padding: 20px; text-align: center; position: relative; }
        .ticket-top::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 100%; height: 20px; background: white; border-radius: 20px 20px 0 0; }
        .ticket-body { padding: 20px; text-align: center; background: white; }
        .ticket-gold-strip { height: 5px; background: var(--gold-grad); width: 100%; }
        .ticket-info-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .ticket-label { font-size: 9px; color: #999; font-weight: bold; }
        .ticket-val { font-size: 11px; color: var(--fpc-navy); font-weight: 900; }
        .ticket-qr { width: 80px; height: 80px; margin: 15px auto; background: #eee; display: flex; align-items: center; justify-content: center; border: 4px solid #f0f0f0; border-radius: 10px; }

        /* ADMIN & MODAIS */
        .admin-row { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; justify-content: space-between; background: #fff; padding: 8px; border-radius: 6px; border: 1px solid #eee; }
        .btn-act { width: 30px; height: 30px; border-radius: 6px; border: none; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .btn-edit { background: var(--pe-blue); }
        .btn-del { background: var(--pe-red); }

        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index: 2000; display:none; flex-direction:column; align-items:center; justify-content:center; }
        .modal-overlay.transp { background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-box { background: white; width: 85%; max-width: 350px; padding: 20px; border-radius: 15px; text-align: center; border-top: 5px solid var(--pe-blue); max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }

        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--fpc-navy); color: white; padding: 10px 20px; border-radius: 20px; font-size: 12px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 3000; width: 80%; text-align: center; }
        .toast.show { opacity: 1; top: 50px; }
        .top-btn { position: absolute; top:15px; width:30px; height:30px; border-radius:50%; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; align-items:center; justify-content:center; cursor:pointer; color:var(--fpc-navy); z-index:50; }
        .top-btn:active { transform:scale(0.9); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

<div class="toast" id="toast"></div>

<div class="modal-overlay transp" id="modal-ticket">
    <div class="modal-box" style="padding:0; border:none; background:transparent">
        <div class="ticket-modal">
            <div class="ticket-gold-strip"></div>
            <div class="ticket-top">
                <img src="logo-fp.jpg" style="width:50px; height:50px; border-radius:50%; border:2px solid white; background:white; object-fit:contain">
                <h2 style="color:white; margin-top:10px; font-size:16px">COMPROVANTE VIP</h2>
                <p style="font-size:10px; opacity:0.8">INSCRI√á√ÉO CONFIRMADA</p>
            </div>
            <div class="ticket-body">
                <div class="ticket-info-row">
                    <div><div class="ticket-label">PILOTO</div><div class="ticket-val" id="tk-nome">NOME</div></div>
                    <div style="text-align:right"><div class="ticket-label">CPF</div><div class="ticket-val" id="tk-cpf">000.***.***-00</div></div>
                </div>
                <div class="ticket-info-row">
                    <div><div class="ticket-label">CATEGORIA</div><div class="ticket-val" id="tk-cat">CAT</div></div>
                    <div style="text-align:right"><div class="ticket-label">DATA</div><div class="ticket-val" id="tk-data">HOJE</div></div>
                </div>
                <div class="ticket-info-row" style="border:none">
                    <div style="text-align:center; width:100%">
                        <div class="ticket-label">EVENTO</div>
                        <div class="ticket-val" id="tk-evento" style="font-size:14px; color:var(--pe-green)">NOME DO EVENTO</div>
                    </div>
                </div>
                <div class="ticket-qr"><i class="fas fa-qrcode" style="font-size:40px; color:#333"></i></div>
                <button class="btn" onclick="compartilharTicket()" style="background:var(--gold-grad); color:#132047"><i class="fas fa-share-alt"></i> COMPARTILHAR</button>
                <button class="btn" onclick="fecharModal('modal-ticket')" style="background:transparent; color:#999; margin-top:0">FECHAR</button>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay transp" id="modal-seguro">
    <div class="modal-box" style="border-top-color: #11998e; max-width: 400px;">
        <h3 style="color:#11998e; margin-bottom: 5px">SEGURO ATLETA</h3>
        <div class="plan-container">
            <div class="plan-card highlight">
                <div style="position:absolute; top:0; right:0; background:var(--pe-green); color:white; font-size:8px; padding:3px 6px; border-radius:0 10px 0 10px">MAIS PEDIDO</div>
                <div class="plan-title">PRO</div>
                <div class="plan-price">R$ 59,90<small>/m√™s</small></div>
                <ul class="plan-list"><li><i class="fas fa-check"></i> Cirurgia (R$ 15k)</li><li><i class="fas fa-check"></i> P√≥s-Cir√∫rgico</li><li><i class="fas fa-check"></i> Car√™ncia Zero</li></ul>
                <button class="btn" style="padding:8px; font-size:10px; margin-top:10px; background:var(--pe-green)" onclick="contratarSeguro('PRO')">ESCOLHER</button>
            </div>
        </div>
        <button class="btn" style="background:transparent; color:#999; margin-top:10px" onclick="fecharModal('modal-seguro')">FECHAR</button>
    </div>
</div>

<div class="modal-overlay transp" id="modal-pix-luck">
    <div class="modal-box" style="border-top-color: #8b5cf6">
        <h3 style="color:#8b5cf6">PAGAR APOSTAS</h3>
        <p style="font-size:11px; color:#666">TOTAL DO CARRINHO</p>
        <div style="background:#f5f3ff; padding:15px; border-radius:8px; margin:10px 0">
            <h1 id="pix-luck-val" style="color:#8b5cf6; margin:0">R$ 0,00</h1>
        </div>
        <div class="pix-key" id="pix-luck-key">...</div>
        <button class="btn" onclick="copiarPixLuck()" style="background:#64748b; font-size:11px; padding:8px"><i class="far fa-copy"></i> COPIAR PIX</button>
        <hr style="border:0; border-top:1px solid #eee; margin: 15px 0">
        <button class="btn" style="background:#8b5cf6" onclick="confirmarPagamentoLuck()">J√Å PAGUEI</button>
        <button class="btn" style="background:transparent; color:#999; margin-top:0" onclick="fecharModal('modal-pix-luck')">CANCELAR</button>
    </div>
</div>

<div class="modal-overlay transp" id="modal-pix">
    <div class="modal-box" style="border-top-color:var(--pe-green)">
        <h3 style="color:var(--fpc-navy)">INSCRI√á√ÉO VIA PIX</h3>
        <p style="font-size:12px; color:#666">VALOR: <b id="pix-valor" style="color:var(--pe-green); font-size:14px">R$ 100,00</b></p>
        <div class="pix-key" id="pix-key-display">CHAVE</div>
        <button class="btn" onclick="copiarPix()" style="background:#64748b; font-size:11px; padding:8px"><i class="far fa-copy"></i> COPIAR CHAVE</button>
        <hr style="border:0; border-top:1px solid #eee; margin: 15px 0">
        <button class="btn" style="background:var(--pe-green)" onclick="confirmarInscricao()">J√Å PAGUEI / CONFIRMAR</button>
        <button class="btn" style="background:transparent; color:#999; margin-top:0" onclick="fecharModal('modal-pix')">CANCELAR</button>
    </div>
</div>

<div class="modal-overlay" id="modal-search">
    <div class="app-container" style="box-shadow:none; padding:20px; width:100%; max-width:420px; background:white">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
            <h3 style="color:var(--fpc-navy); margin:0"><i class="fas fa-search"></i> BUSCAR ATLETA</h3>
            <i class="fas fa-times" style="font-size:20px; color:#999; cursor:pointer" onclick="toggleSearch()"></i>
        </div>
        <div class="input-group">
            <label>FILTRAR POR CATEGORIA (CBC)</label>
            <div class="input-wrapper">
                <select id="search-filter-cat" onchange="filtrarPilotos()">
                    </select>
            </div>
        </div>
        <div class="input-group">
            <div class="input-wrapper">
                <input type="text" id="search-input" placeholder="DIGITE O NOME OU CPF..." onkeyup="filtrarPilotos()">
                <i class="fas fa-search icon-search" onclick="toggleSearch()"></i>
            </div>
        </div>
        <div id="search-results" style="height:100%; overflow-y:auto; text-align:left; margin-top:10px; border-top:1px solid #eee; padding-top:10px">
            <p style="font-size:11px; color:#999; text-align:center">DIGITE PARA BUSCAR</p>
        </div>
    </div>
</div>

<div class="modal-overlay transp" id="modal-edit">
    <div class="modal-box">
        <h3 style="color:var(--pe-blue); margin-bottom:15px">EDITAR EVENTO</h3>
        <input type="hidden" id="edit-idx">
        <div class="input-group"><label>NOME</label><div class="input-wrapper"><input type="text" id="edit-title"></div></div>
        <div class="input-group"><label>CIDADE</label><div class="input-wrapper"><input type="text" id="edit-city"></div></div>
        <div class="input-group"><label>DATA</label><div class="input-wrapper"><input type="text" id="edit-date-text"></div></div>
        <div style="display:flex; gap:10px; margin-bottom:15px; font-size:11px; font-weight:bold; color:var(--text-main)">
            <label style="display:flex;align-items:center;gap:5px"><input type="checkbox" id="edit-cbc" style="width:auto"> RANKING CBC</label>
            <label style="display:flex;align-items:center;gap:5px"><input type="checkbox" id="edit-est" style="width:auto"> RANKING ESTADUAL</label>
        </div>
        <div class="input-group"><label>STATUS</label><div class="input-wrapper"><select id="edit-open"><option value="true">ABERTO</option><option value="false">ENCERRADO</option></select></div></div>
        <button class="btn" onclick="salvarEdicaoEvento()">SALVAR</button>
        <button class="btn" style="background:transparent; color:#999" onclick="fecharModal('modal-edit')">CANCELAR</button>
    </div>
</div>

<div class="modal-overlay transp" id="modal-edit-user">
    <div class="modal-box" style="border-top-color:#8b5cf6">
        <h3 style="color:#8b5cf6; margin-bottom:15px">EDITAR PILOTO</h3>
        <input type="hidden" id="edit-u-idx">
        <div class="input-group"><label>NOME</label><div class="input-wrapper"><input type="text" id="edit-u-nome"></div></div>
        <div class="input-group"><label>CPF</label><div class="input-wrapper"><input type="tel" id="edit-u-cpf" oninput="mascaraCPF(this)"></div></div>
        <div class="input-group"><label>CATEGORIA</label><div class="input-wrapper"><input type="text" id="edit-u-cat"></div></div>
        <div class="input-group"><label>SENHA</label><div class="input-wrapper"><input type="text" id="edit-u-pass"></div></div>
        <button class="btn" style="background:#8b5cf6" onclick="saveUserEdit()">SALVAR ALTERA√á√ïES</button>
        <button class="btn" style="background:transparent; color:#999" onclick="fecharModal('modal-edit-user')">CANCELAR</button>
    </div>
</div>

<div class="app-container">
    <div id="screen-login" class="screen screen-center active">
        <div class="top-btn" style="right:15px" onclick="toggleSearch()"><i class="fas fa-search"></i></div>
        <div style="position:absolute; top:15px; left:15px; font-size:9px; font-weight:900; opacity:0.5" onclick="location.reload(true)">v20.0</div>
        <div style="width:100px; height:100px; margin:0 auto 20px; border-radius:50%; background:white; border:4px solid white; box-shadow:0 5px 15px rgba(0,0,0,0.1); display:flex; align-items:center; justify-content:center; overflow:hidden">
            <img src="logo-fp.jpg" alt="FPC" style="width:100%;height:100%;object-fit:contain">
        </div>
        <h1>ACESSO FPC</h1>
        <div class="input-group"><div class="input-wrapper"><input type="tel" id="login-cpf" placeholder="CPF (000.000.000-00)" oninput="mascaraCPF(this)"></div></div>
        <div class="input-group"><div class="input-wrapper"><input type="password" id="login-pass" placeholder="SENHA"><i class="fas fa-eye icon-eye" onclick="togglePass('login-pass', this)"></i></div></div>
        <button class="btn" onclick="fazerLogin()">ENTRAR</button>
        <button class="btn" onclick="trocarTela('cadastro')" style="background:transparent; color:var(--pe-blue); font-size:12px">CRIAR CONTA</button>
        <div style="margin-top:30px; text-align:center"><span style="font-size:10px; color:#999; text-decoration:underline; cursor:pointer" onclick="trocarTela('admin-login')">SOU ADMIN (ORGANIZADOR)</span></div>
    </div>

    <div id="screen-admin-login" class="screen screen-center">
        <h1 style="color:var(--pe-red)">√ÅREA RESTRITA</h1>
        <p class="subtitle">GEST√ÉO DO SISTEMA</p>
        <div class="input-group"><div class="input-wrapper"><input type="password" id="admin-pass-input" placeholder="SENHA ADMIN"><i class="fas fa-eye icon-eye" onclick="togglePass('admin-pass-input', this)"></i></div></div>
        <button class="btn" style="background:var(--pe-red)" onclick="loginAdmin()">ACESSAR PAINEL</button>
        <button class="btn" style="background:transparent; color:#555" onclick="trocarTela('login')">VOLTAR</button>
    </div>

    <div id="screen-admin-dash" class="screen">
        <h1 style="color:var(--fpc-navy); font-size:18px">GEST√ÉO FPC</h1>
        <div class="input-group"><label>MODALIDADE</label><div class="input-wrapper"><select id="adm-cat-select" onchange="renderAdminEvents()"><option value="DOWNHILL">DOWNHILL</option><option value="SPEED">SPEED</option><option value="MTB">MTB</option><option value="XC / XCO">XC / XCO</option></select></div></div>

        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:15px; border-left:4px solid var(--pe-blue)">
            <b style="color:var(--pe-blue)">1. NOVO EVENTO</b>
            <div class="input-group"><label>NOME</label><div class="input-wrapper"><input type="text" id="adm-evt-title" placeholder="EX: 1¬™ ETAPA"></div></div>
            <div class="input-group"><label>CIDADE</label><div class="input-wrapper"><input type="text" id="adm-evt-city" placeholder="EX: CARUARU-PE"></div></div>
            <div style="display:flex; gap:5px; align-items:flex-end; margin-bottom:10px"><div style="flex:1" class="input-group"><label>DATA</label><div class="input-wrapper"><input type="date" id="adm-evt-date"></div></div></div>
            <div style="display:flex; gap:10px; margin-bottom:10px; font-size:11px; font-weight:bold; color:var(--text-main)">
                <label style="display:flex;align-items:center;gap:5px"><input type="checkbox" id="adm-evt-cbc" style="width:auto"> RANKING CBC</label>
                <label style="display:flex;align-items:center;gap:5px"><input type="checkbox" id="adm-evt-est" style="width:auto"> RANKING ESTADUAL</label>
            </div>
            <button class="btn" style="padding:10px; font-size:12px; margin-top:0" onclick="addEvento()">ADICIONAR</button>
            <div id="adm-event-list" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px"></div>
        </div>

        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:15px; border-left:4px solid var(--pe-green)">
            <b style="color:var(--pe-green)">2. LAN√áAR RESULTADOS</b>
            <div style="margin-bottom:10px"><select id="adm-rank-type" style="font-weight:bold; color:var(--pe-green)"><option value="tempos">‚è±Ô∏è TEMPO</option><option value="ranking">üèÜ PONTOS</option></select></div>
            <div class="input-group"><label>CATEGORIA CBC</label><div class="input-wrapper"><select id="adm-search-filter" style="margin-bottom:5px"></select></div></div>
            <div class="input-group" style="margin-bottom:5px"><div class="input-wrapper"><input type="text" id="adm-rank-name" placeholder="BUSCAR PILOTO..." autocomplete="off" onkeyup="filtrarPilotosParaAdmin()"><i class="fas fa-search icon-search" onclick="toggleAdminSearch()"></i></div><div id="adm-search-list" class="search-dropdown"></div></div>
             <div class="input-group"><div class="input-wrapper"><input id="adm-rank-cat" readonly placeholder="CATEGORIA" style="background:#eee; font-size:11px"></div></div>
            <div style="display:flex; gap:5px; margin-bottom:5px; margin-top:5px"><input type="tel" id="adm-rank-val" placeholder="00:00.000" style="flex:1" oninput="mascaraTempoInput(this)"></div>
            <button class="btn" style="padding:8px; font-size:12px; background:var(--pe-green); margin-top:0" onclick="addResultado()">LAN√áAR</button>
            <button class="btn" style="padding:5px; font-size:10px; background:#ccc; color:black; margin-top:5px" onclick="limparRanking()">LIMPAR</button>
        </div>

        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:15px; border-left:4px solid var(--pe-yellow)">
            <b style="color:#d97706">3. CONFIGURA√á√ïES</b>
            <div class="input-group"><label>CHAVE PIX</label><div class="input-wrapper"><input id="adm-conf-pix"></div></div>
            <div class="input-group"><label>VALOR (R$)</label><div class="input-wrapper"><input id="adm-conf-val"></div></div>
            <div class="input-group"><label>SENHA ADMIN</label><div class="input-wrapper"><input id="adm-conf-pass" type="password"><i class="fas fa-eye icon-eye" onclick="togglePass('adm-conf-pass', this)"></i></div></div>
            <button class="btn" style="background:#d97706" onclick="salvarConfig()">SALVAR</button>
        </div>
        
        <div style="background:white; padding:15px; border-radius:10px; margin-bottom:15px; border-left:4px solid #8b5cf6">
            <b style="color:#8b5cf6">4. GERENCIAR PILOTOS</b>
             <div class="input-group" style="margin-top:10px">
                <label>FILTRAR CATEGORIA</label>
                <div class="input-wrapper">
                    <select id="adm-manage-cat-filter" onchange="renderManageUsers()">
                        </select>
                </div>
            </div>
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="text" id="adm-user-search" placeholder="BUSCAR NOME..." onkeyup="renderManageUsers()">
                    <i class="fas fa-search icon-search" onclick="toggleManageUsers()"></i>
                </div>
            </div>
            <div id="adm-users-list" style="max-height:200px; overflow-y:auto; margin-top:10px"></div>
        </div>

        <button class="btn" style="background:#333" onclick="fazerLogout()">SAIR DO ADMIN</button>
    </div>

    <div id="screen-cadastro" class="screen screen-center">
        <h1 style="color:var(--pe-green)">CADASTRO</h1>
        <div style="overflow-y:auto; padding-bottom:20px">
            <div class="input-group"><label>NOME COMPLETO</label><div class="input-wrapper"><input id="cad-nome"></div></div>
            <div class="input-group"><label>CPF</label><div class="input-wrapper"><input type="tel" id="cad-cpf" oninput="mascaraCPF(this)"></div></div>
            <div class="input-group"><label>NASCIMENTO</label><div class="input-wrapper"><input type="date" id="cad-nasc" onchange="calcCat(this.value)"></div></div>
            <div class="input-group"><label>CATEGORIA (AUTO)</label><div class="input-wrapper"><input id="cad-cat" readonly class="cat-auto" style="background:#eef2ff; color:#132047"></div></div>
            <div class="input-group"><label>SENHA</label><div class="input-wrapper"><input type="password" id="cad-pass"><i class="fas fa-eye icon-eye" onclick="togglePass('cad-pass', this)"></i></div></div>
            <div class="input-group"><label>PALAVRA-CHAVE</label><div class="input-wrapper"><input id="cad-resp"></div></div>
            <button class="btn" onclick="cadastrar()" style="background:var(--pe-green)">CADASTRAR</button>
            <button class="btn" style="background:transparent; color:#555" onclick="trocarTela('login')">VOLTAR</button>
        </div>
    </div>

    <div id="screen-luck" class="screen">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
            <i class="fas fa-arrow-left" onclick="trocarTela('app')" style="padding:10px;cursor:pointer"></i>
            <h2 style="color:var(--fpc-navy);margin:0; font-size:16px">CARRINHO DA SORTE</h2>
        </div>
        <div style="text-align:center">
            
            <div class="federal-board">
                <div class="update-badge">ATUALIZADO AGORA</div>
                <div class="federal-header" id="fed-title">CONCURSO 6032</div>
                <div class="federal-row"><span>1¬∫</span> <b id="fed-1">5492</b></div>
                <div class="federal-row"><span>2¬∫</span> <b id="fed-2">1285</b></div>
                <div class="federal-row"><span>3¬∫</span> <b id="fed-3">9331</b></div>
                <div class="federal-row"><span>4¬∫</span> <b id="fed-4">0455</b></div>
                <div class="federal-row"><span>5¬∫</span> <b id="fed-5">3760</b></div>
                <div style="text-align:center; font-size:8px; color:rgba(255,255,255,0.7); margin-top:5px" id="fed-data">EXTRA√á√ÉO: --</div>
            </div>

            <div class="luck-tabs">
                <div class="luck-tab" id="tab-dezena" onclick="setLuckMode('dezena')">DEZENA</div>
                <div class="luck-tab" id="tab-centena" onclick="setLuckMode('centena')">CENTENA</div>
                <div class="luck-tab" id="tab-milhar" onclick="setLuckMode('milhar')">MILHAR</div>
            </div>
            
            <p id="luck-prize-msg" style="font-size:10px; color:#d97706; margin-bottom:5px; font-weight:bold"></p>

            <div class="luck-inputs-container">
                <div class="luck-field" style="flex:2"><label>N√öMERO</label><input type="tel" id="luck-input" placeholder="0000" maxlength="4" oninput="validarLuckInput(this)"></div>
                <div class="luck-field" style="flex:1"><label>VALOR (R$)</label><input type="number" id="luck-value" placeholder="1.00" oninput="updatePrizeCalc()"></div>
            </div>
            
            <div style="display:flex; gap:5px; margin-bottom:15px">
                <button class="btn" style="flex:1; margin-top:0; font-size:10px; background:#666" onclick="gerarAleatorio()"><i class="fas fa-random"></i> ALEAT√ìRIO</button>
                <button class="btn" style="flex:2; margin-top:0; font-size:10px; background:var(--pe-blue)" onclick="addCarrinho()"><i class="fas fa-plus"></i> ADICIONAR JOGO</button>
            </div>

            <div id="cart-area" style="display:none">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:5px">
                    <b style="font-size:12px; color:#132047">SEUS JOGOS</b>
                    <span style="font-size:10px; color:#999" id="cart-count">0 ITENS</span>
                </div>
                <div style="font-size:9px; color:#22c55e; margin:5px 0">SEU CARRINHO ESPERA POR VOC√ä!</div>
                <div id="cart-list" class="cart-list"></div>
                <div style="margin-top:10px; text-align:right"><span style="font-size:12px; font-weight:bold; color:#132047">TOTAL: R$ <span id="cart-total">0,00</span></span></div>
                <button class="btn" style="background:#8b5cf6" onclick="checkoutLuck()">FINALIZAR COMPRA</button>
            </div>

        </div>
    </div>

    <div id="screen-app" class="screen">
        <div class="app-header">
            <div><span>OL√Å,</span><h2 id="app-name">PILOTO</h2></div>
            <div class="header-logo" onclick="document.getElementById('f-in').click()"><img id="user-img" src="logo-fp.jpg"></div>
            <input type="file" id="f-in" hidden onchange="upFoto(this)">
        </div>

        <div id="main-menu" class="menu-grid">
            <div class="menu-card c-dh" onclick="openCat('DOWNHILL')"><i class="fas fa-mountain"></i><b>DOWNHILL</b></div>
            <div class="menu-card c-sp" onclick="openCat('SPEED')"><i class="fas fa-road"></i><b>SPEED</b></div>
            <div class="menu-card c-mtb" onclick="openCat('MTB')"><i class="fas fa-biking"></i><b>MTB</b></div>
            <div class="menu-card c-xc" onclick="openCat('XC / XCO')"><i class="fas fa-stopwatch"></i><b>XC / XCO</b></div>
            <div class="menu-card c-sorte" onclick="abrirSorte()"><i class="fas fa-clover"></i><b>SORTE</b></div>
            <div class="menu-card c-inf" onclick="openCat('INFORMA√á√ïES')"><i class="fas fa-info-circle"></i><b>INFO</b></div>
        </div>

        <div id="cat-view" style="display:none">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
                <i class="fas fa-arrow-left" onclick="closeCat()" style="padding:10px;cursor:pointer"></i>
                <h2 id="cat-title" style="color:var(--fpc-navy);margin:0">CAT</h2>
            </div>
            <div class="cat-tabs">
                <div class="tab-item active" onclick="tab('calendar')" id="t-calendar"><i class="far fa-calendar-alt"></i> EVENTOS</div>
                <div class="tab-item" onclick="tab('tempos')" id="t-tempos"><i class="fas fa-stopwatch"></i> TEMPOS</div>
                <div class="tab-item" onclick="tab('ranking')" id="t-ranking"><i class="fas fa-trophy"></i> RANKING</div>
                <div class="tab-item" onclick="tab('inscritos')" id="t-inscritos"><i class="fas fa-users"></i> INSCRITOS</div>
            </div>
            <div class="seguro-btn btn" style="background:linear-gradient(90deg,#11998e,#38ef7d); margin-bottom:15px; font-size:12px; display:flex; justify-content:center; gap:5px; box-shadow:none" onclick="abrirSeguro()">
                <i class="fas fa-shield-alt"></i> SEGURO ATLETA & BENEF√çCIOS
            </div>
            
            <div id="cont-calendar" class="c-sec active"></div>
            <div id="cont-tempos" class="c-sec" style="display:none">
                <div class="input-group" style="margin-bottom:10px"><div class="input-wrapper"><select id="filter-cat-tempos" onchange="renderContent('tempos')"><option value="ALL">TODAS CATEGORIAS</option></select></div></div>
                <div id="list-tempos"></div>
            </div>
            <div id="cont-ranking" class="c-sec" style="display:none">
                 <div class="input-group" style="margin-bottom:10px"><div class="input-wrapper"><select id="filter-cat-ranking" onchange="renderContent('ranking')"><option value="ALL">TODAS CATEGORIAS</option></select></div></div>
                <div id="list-ranking"></div>
            </div>
            <div id="cont-inscritos" class="c-sec" style="display:none">
                 <div class="input-group" style="margin-bottom:10px"><div class="input-wrapper"><select id="filter-cat-inscritos" onchange="renderContent('inscritos')"><option value="ALL">TODAS CATEGORIAS</option></select></div></div>
                 <div id="list-inscritos"></div>
            </div>
        </div>
        <div style="margin-top:auto"><button class="btn" style="background:var(--pe-red); width:80px; font-size:10px; margin-left:auto; display:block" onclick="fazerLogout()">SAIR</button></div>
    </div>
</div>

<script>
    const DB_KEY = 'fpc_v20_db';
    const SESS_KEY = 'fpc_sess';
    const CART_KEY = 'fpc_luck_cart';
    
    // CATEGORIAS RIGOROSAS DA CBC (DOWNHILL)
    const CATS_CBC_DH = [
        "ELITE", "SUB-30", "JUNIOR", "JUVENIL", "INFANTO-JUVENIL", 
        "MASTER A1", "MASTER A2", "MASTER B1", "MASTER B2", "MASTER C1", "MASTER C2", "MASTER D",
        "RIGIDA", "FEMININO ELITE", "FEMININO MASTER"
    ];

    const DEFAULT_DB = {
        users: [
            {
                nome: "ABRA√ÉO EVERTON LOPES DE ARA√öJO",
                cpf: "083.276.324-18",
                pass: "0800",
                resp: "PERNA",
                cat: "MASTER A1 (32 ANOS)",
                photo: "logo-fp.jpg",
                inscricoes: []
            }
        ],
        config: { pixKey: "FPC.FINANCEIRO@EMAIL.COM", pixVal: "100,00", adminPass: "ADMIN" },
        data: {
            'DOWNHILL': { 
                events: [
                    { id:1, d:'25/26 ABR', city:'OURICURI-PE', t:'1¬™ ETAPA', cbc:true, est:true, open:true },
                    { id:2, d:'16/17 MAI', city:'CARUARU-PE', t:'2¬™ ETAPA', cbc:true, est:true, open:true },
                    { id:3, d:'29/30 AGO', city:'SANTA CRUZ-PE', t:'3¬™ ETAPA', cbc:false, est:true, open:false },
                    { id:4, d:'19/20 SET', city:'GRAVAT√Å-PE', t:'4¬™ ETAPA', cbc:false, est:true, open:false }
                ], 
                tempos: [], ranking: [], info: "" 
            },
            'SPEED': { events: [{id:1, d:'02 FEV', city:'RECIFE-PE', t:'CIRCUITO DO CAIS', cbc:false, est:true, open:true}], tempos:[], ranking:[], info:"" },
            'MTB': { events:[], tempos:[], ranking:[], info:"" },
            'XC / XCO': { events:[], tempos:[], ranking:[], info:"" },
            'INFORMA√á√ïES': { events:[], tempos:[], ranking:[], info:"" }
        }
    };

    let db = JSON.parse(localStorage.getItem(DB_KEY));
    if(!db) { db = DEFAULT_DB; saveDB(); }
    let currCat = '', currEvtId = null;
    let luckMode = 'milhar'; 
    let luckCart = JSON.parse(localStorage.getItem(CART_KEY)) || [];

    // --- POPULAR SELECTS COM CATEGORIAS CBC ---
    function populateCatSelects() {
        const ids = ['search-filter-cat', 'adm-search-filter', 'adm-manage-cat-filter'];
        const html = `<option value="TODAS">TODAS AS CATEGORIAS</option>` + CATS_CBC_DH.map(c => `<option value="${c}">${c}</option>`).join('');
        ids.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.innerHTML = html;
        });
    }

    function saveDB() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
    function getUser() { return JSON.parse(localStorage.getItem(SESS_KEY)); }
    function saveCart() { localStorage.setItem(CART_KEY, JSON.stringify(luckCart)); }
    function toast(m) { const t=document.getElementById('toast'); t.innerText=m.toUpperCase(); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }

    function togglePass(id, el) {
        const inp = document.getElementById(id);
        if(inp.type === 'password') { inp.type = 'text'; el.classList.remove('fa-eye'); el.classList.add('fa-eye-slash'); el.style.color = 'var(--pe-blue)'; } 
        else { inp.type = 'password'; el.classList.remove('fa-eye-slash'); el.classList.add('fa-eye'); el.style.color = '#a0aec0'; }
    }

    function mascaraTempoInput(input) {
        if(document.getElementById('adm-rank-type').value === 'ranking') return;
        let v = input.value.replace(/\D/g, "");
        if(v.length > 7) v = v.substring(0, 7);
        if(v.length >= 3) v = v.substring(0, v.length-3) + "." + v.substring(v.length-3);
        if(v.length >= 6) v = v.substring(0, v.length-6) + ":" + v.substring(v.length-6);
        input.value = v;
    }

    // --- LOTERIA REAL/SIMULADA ---
    function updateLottery() {
        const d = new Date();
        const days = ['DOM','SEG','TER','QUA','QUI','SEX','SAB'];
        document.getElementById('fed-data').innerText = `EXTRA√á√ÉO: ${days[d.getDay()]} - ${d.toLocaleDateString()}`;
    }

    // --- BUSCA PILOTO (TOGGLE + FECHAR) ---
    function toggleSearch() {
        const m = document.getElementById('modal-search');
        if(m.style.display === 'flex') {
            fecharModal('modal-search');
            document.getElementById('search-input').value = '';
            document.getElementById('search-results').innerHTML = '<p style="font-size:11px; color:#999; text-align:center">DIGITE PARA BUSCAR</p>';
        } else {
            document.getElementById('modal-search').style.display = 'flex'; 
            document.getElementById('search-input').focus(); 
            filtrarPilotos();
        }
    }
    
    function filtrarPilotos() {
        const term = document.getElementById('search-input').value.trim().toUpperCase();
        const catFilter = document.getElementById('search-filter-cat').value; 
        const resDiv = document.getElementById('search-results');
        let filtered = db.users;
        if(term) { filtered = filtered.filter(u => u.nome.includes(term) || u.cpf.includes(term)); }
        if(catFilter !== 'TODAS') { filtered = filtered.filter(u => u.cat && u.cat.includes(catFilter)); }
        if(filtered.length === 0) { resDiv.innerHTML = '<p style="font-size:11px; color:#999; text-align:center">NENHUM PILOTO ENCONTRADO</p>'; return; }
        resDiv.innerHTML = filtered.map(u => `<div style="padding:8px; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; gap:10px"><div style="width:30px; height:30px; border-radius:50%; background:#eee; overflow:hidden"><img src="${u.photo || 'logo-fp.jpg'}" style="width:100%;height:100%;object-fit:cover"></div><div><div style="font-size:12px; font-weight:bold; color:var(--fpc-navy)">${u.nome}</div><div style="font-size:10px; color:#666">${u.cat}</div></div></div>`).join('');
    }

    // --- COMPROVANTE ELEGANTE ---
    function abrirComprovante(evtId, evtTitle, city, date) {
        const u = getUser();
        document.getElementById('tk-nome').innerText = u.nome.length > 20 ? u.nome.substring(0,20)+'...' : u.nome;
        document.getElementById('tk-cpf').innerText = u.cpf;
        document.getElementById('tk-cat').innerText = u.cat.split('(')[0];
        document.getElementById('tk-evento').innerText = evtTitle;
        document.getElementById('tk-data').innerText = date;
        document.getElementById('modal-ticket').style.display = 'flex';
    }

    function compartilharTicket() {
        const t1 = document.getElementById('tk-evento').innerText;
        const t2 = document.getElementById('tk-nome').innerText;
        const msg = `FPC - CONFIRMA√á√ÉO DE INSCRI√á√ÉO\n\nATLETA: ${t2}\nEVENTO: ${t1}\nSTATUS: CONFIRMADO ‚úÖ`;
        if (navigator.share) { navigator.share({ title: 'FPC Ticket', text: msg }).catch((e) => console.log(e)); } 
        else { window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank'); }
    }

    // --- ABA DA SORTE ---
    function abrirSorte() { trocarTela('luck'); setLuckMode('milhar'); renderCart(); updateLottery(); }
    
    function setLuckMode(mode) {
        luckMode = mode;
        document.querySelectorAll('.luck-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-'+mode).classList.add('active');
        document.getElementById('luck-input').value = '';
        document.getElementById('luck-input').placeholder = (mode === 'dezena' ? '00' : (mode === 'centena' ? '000' : '0000'));
        document.getElementById('luck-value').value = '1.00';
        updatePrizeCalc();
    }

    function updatePrizeCalc() {
        const val = parseFloat(document.getElementById('luck-value').value) || 0;
        let mult = 0;
        if(luckMode === 'dezena') { mult = 60; document.getElementById('luck-input').maxLength = 2; }
        if(luckMode === 'centena') { mult = 600; document.getElementById('luck-input').maxLength = 3; }
        if(luckMode === 'milhar') { mult = 6000; document.getElementById('luck-input').maxLength = 4; }
        document.getElementById('luck-prize-msg').innerText = `PR√äMIO: R$ ${(val * mult).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    }

    function validarLuckInput(el) { el.value = el.value.replace(/\D/g,''); }
    function gerarAleatorio() {
        let max = (luckMode === 'dezena' ? 99 : (luckMode === 'centena' ? 999 : 9999));
        let num = Math.floor(Math.random() * (max + 1)).toString();
        let pad = (luckMode === 'dezena' ? 2 : (luckMode === 'centena' ? 3 : 4));
        document.getElementById('luck-input').value = num.padStart(pad, '0');
    }

    function addCarrinho() {
        let num = document.getElementById('luck-input').value;
        let val = parseFloat(document.getElementById('luck-value').value);
        if(!num || !val) return toast("PREENCHA TUDO");
        let reqLen = (luckMode === 'dezena' ? 2 : (luckMode === 'centena' ? 3 : 4));
        if(num.length !== reqLen) return toast(`DIGITE ${reqLen} N√öMEROS`);

        luckCart.push({ type: luckMode, num: num, cost: val });
        saveCart(); renderCart(); toast("ADICIONADO!");
        document.getElementById('luck-input').value = '';
    }

    function renderCart() {
        const area = document.getElementById('cart-area');
        const list = document.getElementById('cart-list');
        const count = document.getElementById('cart-count');
        const total = document.getElementById('cart-total');
        if(luckCart.length === 0) { area.style.display = 'none'; return; }
        area.style.display = 'block';
        count.innerText = luckCart.length + " ITENS";
        let sum = 0;
        list.innerHTML = luckCart.map((item, i) => {
            sum += item.cost;
            return `<div class="cart-item"><div><b>${item.num}</b> (${item.type.toUpperCase()})</div><div style="display:flex;align-items:center;gap:10px"><b>R$ ${item.cost.toFixed(2).replace('.',',')}</b><i class="fas fa-trash" style="color:#ef4444;cursor:pointer" onclick="remItem(${i})"></i></div></div>`;
        }).join('');
        total.innerText = sum.toFixed(2).replace('.', ',');
    }
    function remItem(idx) { luckCart.splice(idx, 1); saveCart(); renderCart(); }
    function checkoutLuck() {
        if(luckCart.length === 0) return;
        let total = luckCart.reduce((a,b) => a + b.cost, 0);
        document.getElementById('pix-luck-val').innerText = "R$ " + total.toFixed(2).replace('.', ',');
        document.getElementById('pix-luck-key').innerText = "00020126580014BR.GOV.BCB.PIX... (COPIA E COLA GERADO)";
        document.getElementById('modal-pix-luck').style.display = 'flex';
    }
    function confirmarPagamentoLuck() { luckCart = []; saveCart(); renderCart(); fecharModal('modal-pix-luck'); toast("APOSTA CONFIRMADA!"); }
    function copiarPixLuck() { navigator.clipboard.writeText("CHAVE PIX FPC"); toast("COPIADO!"); }

    // --- ADMIN ---
    function loginAdmin() {
        if(document.getElementById('admin-pass-input').value.toUpperCase() === db.config.adminPass) {
            trocarTela('admin-dash'); renderAdminEvents(); renderManageUsers();
        } else { toast("SENHA INCORRETA"); }
    }
    
    function renderAdminEvents() {
        const cat = document.getElementById('adm-cat-select').value;
        document.getElementById('adm-conf-pix').value = db.config.pixKey;
        document.getElementById('adm-conf-val').value = db.config.pixVal;
        document.getElementById('adm-conf-pass').value = db.config.adminPass;
        
        const list = document.getElementById('adm-event-list');
        list.innerHTML = db.data[cat].events.map((e, i) => `
            <div class="admin-row">
                <div style="flex:1; font-size:11px"><b>${e.d}</b> - ${e.city}<br>${e.t}</div>
                <button class="btn-act btn-edit" onclick="abrirEdicaoEvento(${i})"><i class="fas fa-pen"></i></button>
                <button class="btn-act btn-del" onclick="delEvent('${cat}', ${i})"><i class="fas fa-trash"></i></button>
            </div>
        `).join('');
    }

    // TOGGLE BUSCA ADMIN (RESULTADOS)
    function toggleAdminSearch() {
        const list = document.getElementById('adm-search-list');
        if(list.style.display === 'block') {
            list.style.display = 'none';
            document.getElementById('adm-rank-name').value = '';
        } else {
            filtrarPilotosParaAdmin();
        }
    }

    // TOGGLE GERENCIAR USUARIOS (LUPA INTELIGENTE)
    function toggleManageUsers() {
        const list = document.getElementById('adm-users-list');
        const input = document.getElementById('adm-user-search');
        
        if(list.innerHTML !== '') {
            list.innerHTML = '';
            input.value = '';
            // Reseta tamb√©m o filtro de categoria para n√£o confundir
            document.getElementById('adm-manage-cat-filter').value = 'TODAS';
        } else {
            renderManageUsers();
        }
    }

    // GERENCIAMENTO DE USU√ÅRIOS
    function renderManageUsers() {
        const term = document.getElementById('adm-user-search').value.trim().toUpperCase();
        const catFilter = document.getElementById('adm-manage-cat-filter').value;
        const listDiv = document.getElementById('adm-users-list');
        
        let filtered = db.users;
        
        // Filtro por Nome/CPF
        if(term) filtered = filtered.filter(u => u.nome.includes(term) || u.cpf.includes(term));
        
        // Filtro por Categoria
        if(catFilter !== 'TODAS') filtered = filtered.filter(u => u.cat && u.cat.includes(catFilter));
        
        if(term === '' && catFilter === 'TODAS' && filtered.length > 50) filtered = filtered.slice(0, 50); // Limit para n√£o travar se vazio

        if(filtered.length === 0) {
            listDiv.innerHTML = '<p style="font-size:10px; color:#999; text-align:center">NENHUM PILOTO ENCONTRADO</p>';
            return;
        }

        listDiv.innerHTML = filtered.map((u, i) => {
            const realIdx = db.users.findIndex(x => x.cpf === u.cpf);
            return `<div class="admin-row">
                <div style="flex:1; font-size:10px; display:flex; align-items:center; gap:5px">
                    <img src="${u.photo||'logo-fp.jpg'}" style="width:20px;height:20px;border-radius:50%">
                    <div><b>${u.nome.split(' ')[0]}</b><br>${u.cat.split('(')[0]}</div>
                </div>
                <button class="btn-act btn-edit" onclick="openEditUser(${realIdx})"><i class="fas fa-pen"></i></button>
                <button class="btn-act btn-del" onclick="deleteUser(${realIdx})"><i class="fas fa-trash"></i></button>
            </div>`;
        }).join('');
    }

    function deleteUser(idx) {
        if(confirm("TEM CERTEZA? ISSO √â IRREVERS√çVEL.")) {
            db.users.splice(idx, 1);
            saveDB();
            renderManageUsers();
            toast("USU√ÅRIO REMOVIDO");
        }
    }

    function openEditUser(idx) {
        const u = db.users[idx];
        document.getElementById('edit-u-idx').value = idx;
        document.getElementById('edit-u-nome').value = u.nome;
        document.getElementById('edit-u-cpf').value = u.cpf;
        document.getElementById('edit-u-cat').value = u.cat;
        document.getElementById('edit-u-pass').value = u.pass;
        document.getElementById('modal-edit-user').style.display = 'flex';
    }

    function saveUserEdit() {
        const idx = document.getElementById('edit-u-idx').value;
        db.users[idx].nome = document.getElementById('edit-u-nome').value.trim().toUpperCase();
        db.users[idx].cpf = document.getElementById('edit-u-cpf').value;
        db.users[idx].cat = document.getElementById('edit-u-cat').value.trim().toUpperCase();
        db.users[idx].pass = document.getElementById('edit-u-pass').value.trim();
        saveDB();
        renderManageUsers();
        fecharModal('modal-edit-user');
        toast("DADOS DO PILOTO ATUALIZADOS");
    }

    function addEvento() {
        const cat = document.getElementById('adm-cat-select').value;
        const title = document.getElementById('adm-evt-title').value.trim().toUpperCase();
        const city = document.getElementById('adm-evt-city').value.trim().toUpperCase();
        const dateInput = document.getElementById('adm-evt-date').value;
        const isCbc = document.getElementById('adm-evt-cbc').checked;
        const isEst = document.getElementById('adm-evt-est').checked;
        if(title && city && dateInput) {
            const [ano, mes, dia] = dateInput.split('-');
            db.data[cat].events.push({ id: Date.now(), d: `${dia}/${mes}`, t: title, city: city, cbc: isCbc, est: isEst, open:true });
            saveDB(); renderAdminEvents(); toast("ADICIONADO!");
        } else { toast("PREENCHA TUDO"); }
    }

    // --- LAN√áAMENTO DE RESULTADOS BLINDADO ---
    function addResultado() {
        const cat = document.getElementById('adm-cat-select').value;
        const type = document.getElementById('adm-rank-type').value;
        const name = document.getElementById('adm-rank-name').value.trim().toUpperCase();
        const userCat = document.getElementById('adm-rank-cat').value.trim().toUpperCase() || "GERAL";
        let val = document.getElementById('adm-rank-val').value.trim();
        
        if(!name || !val) return toast("PREENCHA TUDO");
        
        // VALIDA√á√ÉO: PILOTO EXISTE?
        const exists = db.users.some(u => u.nome === name);
        if(!exists) return toast("PILOTO N√ÉO CADASTRADO!");

        db.data[cat][type].push({ name, val, cat: userCat });
        if(type === 'tempos') db.data[cat][type].sort((a, b) => a.val.localeCompare(b.val));
        else db.data[cat][type].sort((a, b) => parseInt(b.val) - parseInt(a.val));
        
        saveDB(); 
        toast("LAN√áADO COM SUCESSO!");
        
        // LIMPEZA DOS CAMPOS
        document.getElementById('adm-rank-name').value = '';
        document.getElementById('adm-rank-val').value = '';
        document.getElementById('adm-rank-cat').value = '';
    }

    function filtrarPilotosParaAdmin() {
        const term = document.getElementById('adm-rank-name').value.trim().toUpperCase();
        const listDiv = document.getElementById('adm-search-list');
        const filtered = db.users.filter(u => u.nome.includes(term));
        if(filtered.length > 0) {
            listDiv.innerHTML = filtered.map((u) => `<div class="search-item" onclick="selecionarPilotoAdmin('${u.nome}', '${u.cat}')"><span>${u.nome}</span><span style="color:#888; font-size:9px">${u.cat.split('(')[0]}</span></div>`).join('');
            listDiv.style.display = 'block';
        } else listDiv.style.display = 'none';
    }
    function selecionarPilotoAdmin(nome, cat) {
        document.getElementById('adm-rank-name').value = nome;
        document.getElementById('adm-rank-cat').value = cat.split('(')[0].trim();
        document.getElementById('adm-search-list').style.display = 'none';
    }
    function delEvent(cat, idx) { if(confirm("APAGAR?")) { db.data[cat].events.splice(idx, 1); saveDB(); renderAdminEvents(); } }
    function limparRanking() { const c=document.getElementById('adm-cat-select').value; const t=document.getElementById('adm-rank-type').value; if(confirm("LIMPAR?")) { db.data[c][t]=[]; saveDB(); toast("LIMPO!"); } }
    function salvarConfig() {
        db.config.pixKey = document.getElementById('adm-conf-pix').value;
        db.config.pixVal = document.getElementById('adm-conf-val').value;
        const pass = document.getElementById('adm-conf-pass').value;
        if(pass) db.config.adminPass = pass;
        saveDB(); toast("SALVO!");
    }
    function abrirEdicaoEvento(index) {
        const cat = document.getElementById('adm-cat-select').value;
        const ev = db.data[cat].events[index];
        document.getElementById('edit-idx').value = index;
        document.getElementById('edit-title').value = ev.t;
        document.getElementById('edit-city').value = ev.city;
        document.getElementById('edit-date-text').value = ev.d;
        document.getElementById('edit-open').value = ev.open.toString();
        document.getElementById('modal-edit').style.display = 'flex';
    }
    function salvarEdicaoEvento() {
        const cat = document.getElementById('adm-cat-select').value;
        const index = document.getElementById('edit-idx').value;
        const t = document.getElementById('edit-title').value.trim().toUpperCase();
        const city = document.getElementById('edit-city').value.trim().toUpperCase();
        const d = document.getElementById('edit-date-text').value.trim().toUpperCase();
        const cbc = document.getElementById('edit-cbc').checked;
        const est = document.getElementById('edit-est').checked;
        const open = document.getElementById('edit-open').value === 'true';
        db.data[cat].events[index] = { ...db.data[cat].events[index], t, city, d, cbc, est, open };
        saveDB(); renderAdminEvents(); fecharModal('modal-edit'); toast("SALVO!");
    }

    // --- CADASTRO ---
    function calcCat(data) {
        if(!data) return;
        const idade = 2026 - new Date(data).getFullYear();
        let c = "AMADOR";
        if(idade <= 11) c = "KIDS";
        else if(idade >= 12 && idade <= 14) c = "INFANTO-JUVENIL";
        else if(idade >= 15 && idade <= 16) c = "JUVENIL";
        else if(idade >= 17 && idade <= 18) c = "JUNIOR";
        else if(idade >= 19 && idade <= 22) c = "SUB-23 / ELITE";
        else if(idade >= 23 && idade <= 29) c = "SUB-30 / ELITE";
        else if(idade >= 30 && idade <= 34) c = "MASTER A1";
        else if(idade >= 35 && idade <= 39) c = "MASTER A2";
        else if(idade >= 40 && idade <= 44) c = "MASTER B1";
        else if(idade >= 45 && idade <= 49) c = "MASTER B2";
        else if(idade >= 50 && idade <= 54) c = "MASTER C1";
        else if(idade >= 55 && idade <= 59) c = "MASTER C2";
        else if(idade >= 60) c = "MASTER D";
        document.getElementById('cad-cat').value = `${c} (${idade} ANOS)`;
    }

    function cadastrar() {
        const u = {
            nome: document.getElementById('cad-nome').value.trim().toUpperCase(),
            cpf: document.getElementById('cad-cpf').value,
            pass: document.getElementById('cad-pass').value.trim(),
            cat: document.getElementById('cad-cat').value,
            resp: document.getElementById('cad-resp').value.trim().toUpperCase(),
            inscricoes: []
        };
        if(!u.nome || !u.cpf || !u.pass || !u.cat) return toast("PREENCHA TUDO");
        db.users.push(u); saveDB(); toast("CADASTRADO!"); trocarTela('login');
    }

    // --- APP USER ---
    function fazerLogin() {
        const cpf = document.getElementById('login-cpf').value;
        const pass = document.getElementById('login-pass').value;
        const u = db.users.find(x => x.cpf === cpf && x.pass === pass);
        if(u) { localStorage.setItem(SESS_KEY, JSON.stringify(u)); initApp(); } else toast("INV√ÅLIDO");
    }

    function initApp() {
        const u = getUser();
        document.getElementById('app-name').innerText = u.nome.split(' ')[0];
        document.getElementById('user-img').src = u.photo || 'logo-fp.jpg';
        trocarTela('app');
    }

    function openCat(cat) { currCat = cat; document.getElementById('main-menu').style.display='none'; document.getElementById('cat-view').style.display='block'; document.getElementById('cat-title').innerText = cat; tab('calendar'); }
    function closeCat() { document.getElementById('cat-view').style.display='none'; document.getElementById('main-menu').style.display='grid'; }

    function tab(t) {
        document.querySelectorAll('.tab-item').forEach(e=>e.classList.remove('active'));
        document.getElementById('t-'+t).classList.add('active');
        document.querySelectorAll('.c-sec').forEach(e=>e.style.display='none');
        document.getElementById('cont-'+t).style.display='block';
        renderContent(t);
    }

    function renderContent(t) {
        const d = db.data[currCat];
        const div = document.getElementById('cont-'+t);
        const listDiv = document.getElementById('list-'+t);

        if(t === 'inscritos') {
            const userFilter = document.getElementById('filter-cat-inscritos').value;
            const inscr = db.users.filter(u => u.inscricoes.some(i => i.startsWith(currCat)));
            if(document.getElementById('filter-cat-inscritos').options.length <= 1) {
                const cats = [...new Set(inscr.map(i => i.cat.split('(')[0].trim()))];
                document.getElementById('filter-cat-inscritos').innerHTML = `<option value="ALL">TODAS CATEGORIAS</option>` + cats.map(c => `<option value="${c}">${c}</option>`).join('');
            }
            const filtered = userFilter === 'ALL' ? inscr : inscr.filter(u => u.cat.includes(userFilter));
            listDiv.innerHTML = filtered.map(u => `
                <div class="rank-row">
                    <div style="width:30px;height:30px;border-radius:50%;background:#eee;overflow:hidden;margin-right:10px"><img src="${u.photo}" style="width:100%;height:100%;object-fit:cover"></div>
                    <div class="rank-name">${u.nome}<span class="rank-cat">${u.cat}</span></div>
                    <i class="fas fa-check-circle" style="color:var(--pe-green)"></i>
                </div>
            `).join('') || '<p style="text-align:center;font-size:12px;color:#999;margin-top:20px">NENHUM INSCRITO.</p>';
        }
        
        if(t === 'calendar') {
            const u = getUser();
            div.innerHTML = d.events.map(e => {
                const inscrito = u.inscricoes.includes(currCat+e.id);
                return `<div class="event-card">
                    <div style="flex:1">
                        <div class="event-header"><span class="event-date">${e.d}</span><div class="badge-box">${e.est?'<span class="badge b-est">RANKING PE</span>':''}${e.cbc?'<span class="badge b-cbc">RANKING CBC</span>':''}</div></div>
                        <div style="font-size:13px;font-weight:bold;color:#132047">${e.t}</div>
                        <div class="event-city"><i class="fas fa-map-marker-alt"></i> ${e.city}</div>
                    </div>
                    <div style="width:35%">${e.open? (inscrito ? `<button class="btn-insc inscrito" onclick="abrirComprovante('${e.id}','${e.t}','${e.city}','${e.d}')">J√Å SOU INSCRITO</button>` : `<button class="btn-insc" onclick="preInsc('${e.id}')">INSCREVER</button>`) : `<button class="btn-insc pendente">ENCERRADO</button>`}</div>
                </div>`;
            }).join('') || '<p style="text-align:center;font-size:12px;color:#999;margin-top:20px">NENHUM EVENTO.</p>';
        }

        if(t === 'tempos' || t === 'ranking') {
            const rawList = d[t];
            if(!rawList.length) { listDiv.innerHTML = '<p style="text-align:center;font-size:12px;color:#999;margin-top:20px">INDISPON√çVEL.</p>'; return; }
            const filterSel = document.getElementById('filter-cat-'+t);
            const cats = [...new Set(rawList.map(item => item.cat || 'GERAL'))];
            const currentSel = filterSel.value;
            filterSel.innerHTML = `<option value="ALL">TODAS CATEGORIAS</option>` + cats.map(c => `<option value="${c}">${c}</option>`).join('');
            if(cats.includes(currentSel)) filterSel.value = currentSel;
            const selectedCat = filterSel.value;
            const filteredList = selectedCat === 'ALL' ? rawList : rawList.filter(item => (item.cat || 'GERAL') === selectedCat);
            listDiv.innerHTML = `<div class="rank-header"><span>POS</span><span style="flex:1;margin-left:10px">${t==='ranking'?'PILOTO (PTS)':'PILOTO (TEMPO)'}</span><span>${t==='ranking'?'ESTADUAL':'CRON√îMETRO'}</span></div>` + 
            filteredList.map((r, i) => `<div class="rank-row"><div class="rank-pos">${i+1}¬∫</div><div class="rank-name">${r.name}<span class="rank-cat">${r.cat || 'GERAL'}</span></div><div class="rank-val">${r.val}</div></div>`).join('');
        }
    }

    function preInsc(evtId) { currEvtId=evtId; document.getElementById('pix-key-display').innerText=db.config.pixKey; document.getElementById('pix-valor').innerText="R$ "+db.config.pixVal; document.getElementById('modal-pix').style.display='flex'; }
    function copiarPix(){ navigator.clipboard.writeText(db.config.pixKey); toast("COPIADO!"); }
    function confirmarInscricao(){ const u=getUser(); u.inscricoes.push(currCat+currEvtId); localStorage.setItem(SESS_KEY,JSON.stringify(u)); const idx=db.users.findIndex(x=>x.cpf===u.cpf); if(idx>-1)db.users[idx].inscricoes=u.inscricoes; saveDB(); fecharModal('modal-pix'); renderContent('calendar'); toast("INSCRI√á√ÉO CONFIRMADA!"); }
    function fecharModal(id){ document.getElementById(id).style.display='none'; }
    function fazerLogout(){ localStorage.removeItem(SESS_KEY); trocarTela('login'); }
    function trocarTela(id){ document.querySelectorAll('.screen').forEach(e=>e.classList.remove('active')); document.getElementById('screen-'+id).classList.add('active'); }
    function mascaraCPF(i){ i.value=i.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"); }
    function upFoto(i){ if(i.files&&i.files[0]){const r=new FileReader();r.onload=function(e){const u=getUser();u.photo=e.target.result;localStorage.setItem(SESS_KEY,JSON.stringify(u));document.getElementById('user-img').src=u.photo;const idx=db.users.findIndex(x=>x.cpf===u.cpf);db.users[idx].photo=u.photo;saveDB();};r.readAsDataURL(i.files[0]);}}

    populateCatSelects();
    const s = getUser(); if(s) initApp();
</script>
</body>
</html>
